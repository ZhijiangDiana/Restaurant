<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Register</title>
    <link rel="stylesheet" href="css/register.css">
    <!-- 引入 Element UI 样式 -->
    <link rel="stylesheet" href="https://unpkg.com/element-ui/lib/theme-chalk/index.css">
    <script src="https://unpkg.com/vue@2.6.14/dist/vue.js"></script>
    <script src="https://unpkg.com/element-ui/lib/index.js"></script>
</head>
<body>
<div id="app">
    <el-container>
        <el-aside width="750px">
            <img src="image/aside_image.png" alt="Aside Image" style="width: 750px; height: 700px;">
        </el-aside>
        <el-main>
            <div style="display: flex; align-items: center;">
                <el-image :src="src1" style="width: 50px; height: 50px;"></el-image>
                <span style="font-size: 35px; color: #333;">食堂点评交流系统，欢迎您</span>
            </div><br>
            <form @submit="register">
                <el-select v-model="form.character" placeholder="请选择" class="my-select">
                    <el-option v-for="item in options" :key="item.value" :label="item.label"
                               :value="item.value"></el-option>
                </el-select><br><br>
                <el-input v-model="form.id" placeholder="请输入学号/工号" prefix-icon="el-icon-user"></el-input><br><br>
                <el-input v-model="form.password" placeholder="请输入密码" show-password
                          prefix-icon="el-icon-lock"></el-input><br><br>
                <el-input v-model="form.repassword" placeholder="请再次输入密码" show-password
                          prefix-icon="el-icon-lock"></el-input><br><br>
                <button type="submit" class="btn">注册</button><br>
                <button type="button" class="btn" @click="backToLogin">已有账号，返回登录界面</button>
            </form>
        </el-main>
    </el-container>
</div>

<script>
    new Vue({
        el: '#app',
        data: function () {
            return {
                form: {
                    character:'',
                    id: '',
                    password: '',
                    repassword:''
                },
                src1: 'https://tvax3.sinaimg.cn/crop.0.0.1242.1242.1024/6e8ddc55ly8fpxftv5ag3j20yi0yigoy.jpg',
                options: [
                    {
                        value: '选项1',
                        label: '系统管理员'
                    },
                    {
                        value: '选项2',
                        label: '食堂管理员'
                    },
                    {
                        value: '选项3',
                        label: '师生用户'
                    }
                ],
                value: '',
            };
        },
        methods: {
            register(event) {
                event.preventDefault(); // 阻止默认的表单提交行为
                if (this.form.character === '') {
                    this.$message({
                        message: '请选择注册角色',
                        type: 'warning'
                    });
                    return;
                }
                if (this.form.id === '') {
                    this.$message({
                        message: '请输入学号/工号',
                        type: 'warning'
                    });
                    return;
                }
                if (this.form.password === '') {
                    this.$message({
                        message: '请输入密码',
                        type: 'warning'
                    });
                    return;
                }
                if (this.form.repassword === '') {
                    this.$message({
                        message: '请再次输入密码',
                        type: 'warning'
                    });
                    return;
                }
                if (this.form.repassword !== this.form.password) {
                    this.$message({
                        message: '两次密码输入不一致',
                        type: 'warning'
                    });
                    return;
                }
                fetch('http://localhost:8080/restaurant/register', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(this.form)
                })
                    .then(response => {
                        if (!response.ok) {
                            throw new Error('Network response was not ok');
                        }
                        return response.json();
                    })
                    .then(result => {
                        if (result.flag === '0') {
                            this.$message.success('注册成功');
                            window.location.href = 'register.html';
                        } else {
                            this.$message.error(result.message);
                        }
                    })
                    .catch(error => {
                        this.$message.error('注册失败');
                    });
            },
            backToLogin() {
                window.location.href = 'http://localhost:8080/restaurant/login.html';
            },
        },
    })
</script>
</body>
</html>